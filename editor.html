
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 1: Design Card</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Dancing+Script:wght@700&family=Roboto:wght@400;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root { --font-main: 'Plus Jakarta Sans', sans-serif; }
  html[lang="ar"] { --font-main: 'Cairo', sans-serif; }
  body {
    font-family: var(--font-main);
    background-color: #0f172a;
    background-image:
      radial-gradient(at 20% 25%, hsla(212,80%,30%,0.3) 0px, transparent 50%),
      radial-gradient(at 80% 20%, hsla(280,75%,40%,0.3) 0px, transparent 50%),
      radial-gradient(at 50% 80%, hsla(320,70%,50%,0.2) 0px, transparent 50%);
  }
  .glass-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15);
  }
  .btn-primary {
    @apply font-bold py-3 px-6 rounded-lg text-white transition-all duration-300 ease-in-out;
    background: linear-gradient(90deg, #6366F1, #8B5CF6);
    box-shadow: 0 4px 15px 0 rgba(116, 79, 168, 0.5);
  }
  .btn-primary:hover:not(:disabled) {
    @apply shadow-2xl scale-105;
    box-shadow: 0 6px 20px 0 rgba(116, 79, 168, 0.65);
  }
  .btn-primary:disabled { background: #374151; box-shadow: none; transform: none; cursor: not-allowed; opacity: 0.6; }
  #positioning-area { touch-action: none; }
  .placeholder {
    position: absolute; cursor: move; user-select: none; top: 0; left: 0;
    display: flex; align-items: center; justify-content: center;
    border: 2px dashed rgba(255, 255, 255, 0.7);
  }
  #qr-placeholder-img { max-width: 100%; height: auto; }
  #image-drop-area { border: 2px dashed rgba(255, 255, 255, 0.2); }
  #image-drop-area.dragover { border-color: #8B5CF6; background-color: rgba(139, 92, 246, 0.1); }
  input[type="range"]::-webkit-slider-thumb { @apply bg-indigo-400; }
  input[type="range"]::-moz-range-thumb { @apply bg-indigo-400; }
</style>
</head>
<body class="text-gray-200">

<header class="bg-slate-900/50 backdrop-blur-lg border-b border-white/10 sticky top-0 z-20">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-gray-100" data-lang-key="headerTitle">Step 1: Design Your Card</h1>
    <div>
        <a href="index.html" class="text-sm font-semibold text-indigo-400 hover:text-indigo-300 transition-colors" data-lang-key="backToHub">&larr; Back to Hub</a>
        <button id="lang-switcher" class="font-bold text-sm border border-white/20 rounded-md px-3 py-1.5 hover:bg-white/10 transition-colors ms-4">AR</button>
    </div>
  </div>
</header>

<main class="container mx-auto p-4 md:p-8 flex justify-center">
  <div class="w-full max-w-7xl">
    <div id="uploader-section" class="glass-card p-6 rounded-2xl">
      <h2 class="text-xl font-semibold text-gray-100 mb-2" data-lang-key="uploadTitle">1. Upload Invitation Design</h2>
      <p class="text-sm text-gray-400 mb-6" data-lang-key="uploadDesc">Drag & drop your image file or click to select. This will be the background for your card.</p>
      <div id="image-drop-area" class="relative flex flex-col items-center justify-center w-full h-64 rounded-lg cursor-pointer bg-white/5 hover:bg-white/10 transition-colors">
          <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <svg class="w-10 h-10 mb-4 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/></svg>
              <p class="mb-2 text-sm text-gray-400"><span class="font-semibold" data-lang-key="clickToUpload">Click to upload</span><span data-lang-key="orDragDrop"> or drag and drop</span></p>
              <p class="text-xs text-gray-500">PNG, JPG or GIF</p>
          </div>
          <input type="file" id="imageUploader" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"/>
      </div>
      <img id="imagePreview" class="mt-4 rounded-md hidden border-2 border-white/10 w-full" alt="Image Preview"/>
      <button id="uploadButton" class="mt-6 w-full btn-primary" data-lang-key="uploadBtn" disabled>Upload & Continue to Editor</button>
      <div id="uploadSpinner" class="hidden mt-4 text-center"><div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] text-indigo-400" role="status"></div><p class="text-sm text-gray-400 mt-2" data-lang-key="uploading">Uploading to secure storage...</p></div>
    </div>

    <div id="editor-section" class="hidden">
      <div class="glass-card p-6 rounded-2xl">
        <h2 class="text-xl font-semibold text-gray-100 mb-2" data-lang-key="editorTitle">2. Position & Style Guest Details</h2>
        <p class="text-sm text-gray-400 mb-6" data-lang-key="editorDesc">Drag the placeholders to position them. Use the controls on the right to customize their appearance.</p>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div id="positioning-area" class="lg:col-span-2 relative inline-block select-none overflow-hidden rounded-lg border-2 border-white/10 bg-black">
            <img id="editor-image-preview" src="" class="max-w-full h-auto block opacity-80" alt="Invitation Preview"/>
            <div id="name-placeholder" class="placeholder p-2 font-bold" style="color: white; font-family: 'Roboto', sans-serif;" data-lang-key="guestName">Guest Name</div>
            <div id="qr-placeholder" class="placeholder"><img id="qr-placeholder-img" src="" alt="QR Code Preview"/></div>
          </div>
          <div class="space-y-4">
              <div class="bg-slate-800/50 p-4 rounded-lg">
                  <h3 class="font-bold text-lg text-gray-100 border-b border-white/10 mb-3 pb-2" data-lang-key="nameStyleTitle">Guest Name Customization</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div><label class="block text-sm font-medium text-gray-400" data-lang-key="fontColor">Font Color</label><input type="color" id="font-color-picker" class="p-1 h-10 w-full bg-slate-800 border border-slate-600 cursor-pointer rounded-lg"></div>
                      <div><label class="block text-sm font-medium text-gray-400" data-lang-key="fontFamily">Font Family</label><select id="font-family-select" class="w-full p-2 bg-slate-800 border border-slate-600 rounded-lg text-gray-200"><option value="'Roboto', sans-serif">Roboto</option><option value="'Amiri', serif">Amiri</option><option value="'Dancing Script', cursive">Dancing Script</option></select></div>
                      <div class="col-span-2"><label class="block text-sm font-medium text-gray-400" data-lang-key="fontSize">Font Size</label><input id="font-size-slider" type="range" min="8" max="100" class="w-full h-2 bg-slate-700 rounded-lg cursor-pointer"></div>
                      <div class="col-span-2"><label class="block text-sm font-medium text-gray-400" data-lang-key="rotation">Rotation</label><input id="font-rotation-slider" type="range" min="-45" max="45" value="0" class="w-full h-2 bg-slate-700 rounded-lg cursor-pointer"></div>
                      <div class="col-span-2 flex gap-4"><div class="flex items-center"><input type="checkbox" id="font-bold-toggle" class="h-4 w-4 rounded bg-slate-700 border-slate-500"><label for="font-bold-toggle" class="ms-2 text-sm text-gray-300" data-lang-key="bold">Bold</label></div><div class="flex items-center"><input type="checkbox" id="font-italic-toggle" class="h-4 w-4 rounded bg-slate-700 border-slate-500"><label for="font-italic-toggle" class="ms-2 text-sm text-gray-300" data-lang-key="italic">Italic</label></div></div>
                      <div class="col-span-2 border-t border-white/10 pt-3"><label class="flex items-center"><input type="checkbox" id="shadow-toggle" class="h-4 w-4 rounded"><span class="ms-2 text-sm font-medium text-gray-300" data-lang-key="textShadow">Text Shadow</span></label></div>
                      <div id="shadow-controls" class="hidden col-span-2 grid grid-cols-2 gap-4">
                          <div><label class="text-xs text-gray-400">Color</label><input type="color" id="shadow-color-picker" class="p-1 h-8 w-full bg-slate-700 border border-slate-600 rounded"></div>
                          <div><label class="text-xs text-gray-400">Blur</label><input type="range" id="shadow-blur-slider" min="0" max="20" class="w-full"></div>
                          <div><label class="text-xs text-gray-400">Offset X</label><input type="range" id="shadow-offset-x-slider" min="-10" max="10" class="w-full"></div>
                          <div><label class="text-xs text-gray-400">Offset Y</label><input type="range" id="shadow-offset-y-slider" min="-10" max="10" class="w-full"></div>
                      </div>
                      <div class="col-span-2 border-t border-white/10 pt-3"><label class="flex items-center"><input type="checkbox" id="stroke-toggle" class="h-4 w-4 rounded"><span class="ms-2 text-sm font-medium text-gray-300" data-lang-key="textStroke">Text Stroke</span></label></div>
                      <div id="stroke-controls" class="hidden col-span-2 grid grid-cols-2 gap-4">
                          <div><label class="text-xs text-gray-400">Color</label><input type="color" id="stroke-color-picker" class="p-1 h-8 w-full bg-slate-700 border border-slate-600 rounded"></div>
                          <div><label class="text-xs text-gray-400">Width</label><input type="range" id="stroke-width-slider" min="0" max="5" step="0.5" class="w-full"></div>
                      </div>
                  </div>
              </div>
              <div class="bg-slate-800/50 p-4 rounded-lg">
                  <h3 class="font-bold text-lg text-gray-100 border-b border-white/10 mb-3 pb-2" data-lang-key="qrStyleTitle">QR Code Customization</h3>
                  <div class="grid grid-cols-2 gap-4">
                      <div class="col-span-2"><label class="block text-sm font-medium text-gray-400" data-lang-key="qrSize">Size</label><input id="qr-size-slider" type="range" min="40" max="400" class="w-full h-2 bg-slate-700 rounded-lg cursor-pointer"></div>
                      <div><label class="text-sm text-gray-400">Modules</label><input type="color" id="qr-color-dark-picker" class="p-1 h-10 w-full bg-slate-800 border border-slate-600 rounded"></div>
                      <div><label class="text-sm text-gray-400">Background</label><input type="color" id="qr-color-light-picker" class="p-1 h-10 w-full bg-slate-800 border border-slate-600 rounded"></div>
                      <div class="col-span-2"><label class="block text-sm text-gray-400" data-lang-key="qrLogo">Center Logo</label><input type="file" id="qr-logo-uploader" accept="image/png, image/jpeg" class="text-xs file:mr-2 file:py-1 file:px-2 file:rounded-md file:border-0 file:bg-indigo-500 file:text-white hover:file:bg-indigo-600"></div>
                  </div>
              </div>
          </div>
        </div>
        <button id="save-positions-button" class="mt-8 w-full btn-primary" data-lang-key="saveBtn">Save Design & Continue &rarr;</button>
      </div>
    </div>
  </div>
</main>
<div id="notification" class="fixed top-5 right-5 bg-green-500 text-white py-3 px-6 rounded-lg shadow-xl transform translate-x-[120%] transition-transform duration-500 ease-in-out"></div>
<script type="module">
import QRCode from 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/+esm';
// ... rest of the script will be defined below
</script>
<script type="module">
const translations = {
    en: { headerTitle: "Step 1: Design Your Card", backToHub: "← Back to Hub", uploadTitle: "1. Upload Invitation Design", uploadDesc: "Drag & drop your image file or click to select. This will be the background for your card.", clickToUpload: "Click to upload", orDragDrop: " or drag and drop", uploadBtn: "Upload & Continue to Editor", uploading: "Uploading to secure storage...", editorTitle: "2. Position & Style Guest Details", editorDesc: "Drag the placeholders to position them. Use the controls on the right to customize their appearance.", guestName: "Guest Name", nameStyleTitle: "Guest Name Customization", fontColor: "Font Color", fontFamily: "Font Family", fontSize: "Font Size", rotation: "Rotation", bold: "Bold", italic: "Italic", textShadow: "Text Shadow", textStroke: "Text Stroke", qrStyleTitle: "QR Code Customization", qrSize: "Size", qrLogo: "Center Logo", saveBtn: "Save Design & Continue →", selectImageFirst: "Please select an image first", uploadSuccess: "Upload successful! Now, design your card.", uploadFailed: "Image upload failed: ", designSaved: "Design saved! Redirecting...", },
    ar: { headerTitle: "الخطوة ١: تصميم بطاقتك", backToHub: "→ العودة للمركز", uploadTitle: "١. رفع تصميم الدعوة", uploadDesc: "اسحب وأفلت ملف الصورة أو انقر للاختيار. ستكون هذه هي خلفية بطاقتك.", clickToUpload: "انقر للرفع", orDragDrop: " أو اسحب وأفلت", uploadBtn: "رفع ومتابعة إلى المحرر", uploading: "جاري الرفع إلى التخزين الآمن...", editorTitle: "٢. تحديد أماكن وتنسيق تفاصيل الضيف", editorDesc: "اسحب العناصر لتحديد أماكنها. استخدم عناصر التحكم على اليسار لتخصيص مظهرها.", guestName: "اسم الضيف", nameStyleTitle: "تخصيص اسم الضيف", fontColor: "لون الخط", fontFamily: "نوع الخط", fontSize: "حجم الخط", rotation: "دوران", bold: "عريض", italic: "مائل", textShadow: "ظل النص", textStroke: "إطار النص", qrStyleTitle: "تخصيص رمز QR", qrSize: "الحجم", qrLogo: "شعار في المنتصف", saveBtn: "حفظ التصميم والمتابعة ←", selectImageFirst: "الرجاء اختيار صورة أولاً", uploadSuccess: "تم الرفع بنجاح! الآن، قم بتصميم بطاقتك.", uploadFailed: "فشل رفع الصورة: ", designSaved: "تم حفظ التصميم! جارٍ إعادة التوجيه...", }
};
const langSwitcher = document.getElementById('lang-switcher');
let currentLang = localStorage.getItem('language') || 'en';
const setLanguage = (lang) => { localStorage.setItem('language', lang); currentLang = lang; document.documentElement.lang = lang; document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'; langSwitcher.textContent = lang === 'ar' ? 'EN' : 'AR'; document.querySelectorAll('[data-lang-key]').forEach(el => { const key = el.getAttribute('data-lang-key'); if (translations[lang][key]) { if(key === 'orDragDrop') { el.previousElementSibling.textContent = translations[lang]['clickToUpload']; el.textContent = translations[lang]['orDragDrop']; } else { el.textContent = translations[lang][key]; } } }); document.title = translations[lang].headerTitle; const namePlaceholder = document.getElementById('name-placeholder'); if (namePlaceholder) { namePlaceholder.textContent = translations[lang].guestName; } };
langSwitcher.addEventListener('click', () => setLanguage(currentLang === 'en' ? 'ar' : 'en'));
document.addEventListener('DOMContentLoaded', () => setLanguage(currentLang));

const IMGBB_API_KEY = '97c60166127ae9258012f463e09b1e2d';
const DOMElements = { uploaderSection: document.getElementById('uploader-section'), editorSection: document.getElementById('editor-section'), imageUploader: document.getElementById('imageUploader'), imagePreview: document.getElementById('imagePreview'), uploadButton: document.getElementById('uploadButton'), uploadSpinner: document.getElementById('uploadSpinner'), imageDropArea: document.getElementById('image-drop-area'), editorImagePreview: document.getElementById('editor-image-preview'), positioningArea: document.getElementById('positioning-area'), namePlaceholder: document.getElementById('name-placeholder'), qrPlaceholder: document.getElementById('qr-placeholder'), qrPlaceholderImg: document.getElementById('qr-placeholder-img'), savePositionsButton: document.getElementById('save-positions-button'), notification: document.getElementById('notification'), };
const controls = { color: document.getElementById('font-color-picker'), family: document.getElementById('font-family-select'), size: document.getElementById('font-size-slider'), rotation: document.getElementById('font-rotation-slider'), bold: document.getElementById('font-bold-toggle'), italic: document.getElementById('font-italic-toggle'), shadow: document.getElementById('shadow-toggle'), shadowControls: document.getElementById('shadow-controls'), shadowColor: document.getElementById('shadow-color-picker'), shadowBlur: document.getElementById('shadow-blur-slider'), shadowX: document.getElementById('shadow-offset-x-slider'), shadowY: document.getElementById('shadow-offset-y-slider'), stroke: document.getElementById('stroke-toggle'), strokeControls: document.getElementById('stroke-controls'), strokeColor: document.getElementById('stroke-color-picker'), strokeWidth: document.getElementById('stroke-width-slider'), qrSize: document.getElementById('qr-size-slider'), qrColorDark: document.getElementById('qr-color-dark-picker'), qrColorLight: document.getElementById('qr-color-light-picker'), qrLogo: document.getElementById('qr-logo-uploader'), };
let selectedFile = null, cardImageUrl = '', qrLogoUrl = '';
const settings = { name: { x: 20, y: 20, color: '#FFFFFF', family: "'Roboto', sans-serif", size: 40, rotation: 0, bold: false, italic: false, shadow: { enabled: false, color: '#000000', blur: 0, x: 0, y: 0 }, stroke: { enabled: false, color: '#000000', width: 1 } }, qr: { x: 20, y: 80, size: 100, colorDark: '#000000', colorLight: '#FFFFFF', logoUrl: '' } };

const showNotification = (messageKey, type = 'green', isKey = true) => { const message = isKey ? translations[currentLang][messageKey] : messageKey; const colors = { green: 'bg-green-500', red: 'bg-red-500', yellow: 'bg-yellow-500' }; DOMElements.notification.className = `fixed top-5 right-5 text-white py-3 px-6 rounded-lg shadow-xl transition-transform duration-500 ease-in-out ${colors[type] || 'bg-gray-500'} transform translate-x-[120%]`; DOMElements.notification.textContent = message; DOMElements.notification.style.transform = 'translateX(0)'; setTimeout(() => DOMElements.notification.style.transform = 'translateX(120%)', 3000); };
const updatePlaceholders = async () => { const s = settings.name; const np = DOMElements.namePlaceholder; np.style.color = s.color; np.style.fontFamily = s.family; np.style.fontSize = `${s.size}px`; np.style.fontWeight = s.bold ? 'bold' : 'normal'; np.style.fontStyle = s.italic ? 'italic' : 'normal'; np.style.transform = `translate3d(${s.x}px, ${s.y}px, 0) rotate(${s.rotation}deg)`; np.style.textShadow = s.shadow.enabled ? `${s.shadow.x}px ${s.shadow.y}px ${s.shadow.blur}px ${s.shadow.color}` : 'none'; np.style.webkitTextStroke = s.stroke.enabled ? `${s.stroke.width}px ${s.stroke.color}` : 'unset'; const q = settings.qr; const qp = DOMElements.qrPlaceholder; qp.style.width = `${q.size}px`; qp.style.height = `${q.size}px`; qp.style.transform = `translate3d(${q.x}px, ${q.y}px, 0)`; const qrDataUrl = await QRCode.toDataURL('PREVIEW', { width: 400, margin: 1, errorCorrectionLevel: 'H', color: { dark: q.colorDark, light: q.colorLight } }); DOMElements.qrPlaceholderImg.src = qrDataUrl; };
function makeDraggable(element, settingObj) { let active = false, initialX, initialY; const dragStart = (e) => { if (e.target === element || element.contains(e.target)) { active = true; element.style.zIndex = 10; initialX = e.type === 'touchstart' ? e.touches[0].clientX - settingObj.x : e.clientX - settingObj.x; initialY = e.type === 'touchstart' ? e.touches[0].clientY - settingObj.y : e.clientY - settingObj.y; } }; const dragEnd = () => { active = false; element.style.zIndex = 1; }; const drag = (e) => { if (active) { e.preventDefault(); const currentX = e.type === 'touchmove' ? e.touches[0].clientX - initialX : e.clientX - initialX; const currentY = e.type === 'touchmove' ? e.touches[0].clientY - initialY : e.clientY - initialY; const parentRect = DOMElements.positioningArea.getBoundingClientRect(); const elemRect = element.getBoundingClientRect(); settingObj.x = Math.max(0, Math.min(currentX, parentRect.width - elemRect.width)); settingObj.y = Math.max(0, Math.min(currentY, parentRect.height - elemRect.height)); updatePlaceholders(); } }; ['touchstart', 'mousedown'].forEach(evt => DOMElements.positioningArea.addEventListener(evt, dragStart, false)); ['touchend', 'mouseup', 'mouseleave'].forEach(evt => DOMElements.positioningArea.addEventListener(evt, dragEnd, false)); ['touchmove', 'mousemove'].forEach(evt => DOMElements.positioningArea.addEventListener(evt, drag, false)); }
const uploadAndSetUrl = async (file, onComplete) => { const formData = new FormData(); formData.append('image', file); try { const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData }); const result = await response.json(); if (result.success) { onComplete(result.data.url); } else { throw new Error(result.error?.message || 'Unknown error'); } } catch (error) { showNotification(translations[currentLang].uploadFailed + error.message, 'red', false); } };
const setupEventListeners = () => { ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => DOMElements.imageDropArea.addEventListener(e, evt => { evt.preventDefault(); evt.stopPropagation(); }, false)); ['dragenter', 'dragover'].forEach(e => DOMElements.imageDropArea.addEventListener(e, () => DOMElements.imageDropArea.classList.add('dragover'), false)); ['dragleave', 'drop'].forEach(e => DOMElements.imageDropArea.addEventListener(e, () => DOMElements.imageDropArea.classList.remove('dragover'), false)); DOMElements.imageDropArea.addEventListener('drop', e => handleFile(e.dataTransfer.files[0]), false); DOMElements.imageUploader.addEventListener('change', e => handleFile(e.target.files[0])); DOMElements.uploadButton.addEventListener('click', async () => { if (!selectedFile) { showNotification('selectImageFirst', 'yellow'); return; } DOMElements.uploadButton.disabled = true; DOMElements.uploadSpinner.classList.remove('hidden'); await uploadAndSetUrl(selectedFile, url => { cardImageUrl = url; showNotification('uploadSuccess', 'green'); DOMElements.editorImagePreview.src = cardImageUrl; DOMElements.uploaderSection.classList.add('hidden'); DOMElements.editorSection.classList.remove('hidden'); DOMElements.uploadSpinner.classList.add('hidden'); }); }); for (const key in controls) { const el = controls[key]; if (el.type === 'checkbox') el.addEventListener('change', updateSettings); else el.addEventListener('input', updateSettings); } DOMElements.savePositionsButton.addEventListener('click', saveAndRedirect); };
function updateSettings(e) { const s = settings.name; const q = settings.qr; switch (e.target.id) { case 'font-color-picker': s.color = e.target.value; break; case 'font-family-select': s.family = e.target.value; break; case 'font-size-slider': s.size = e.target.value; break; case 'font-rotation-slider': s.rotation = e.target.value; break; case 'font-bold-toggle': s.bold = e.target.checked; break; case 'font-italic-toggle': s.italic = e.target.checked; break; case 'shadow-toggle': s.shadow.enabled = e.target.checked; controls.shadowControls.classList.toggle('hidden'); break; case 'shadow-color-picker': s.shadow.color = e.target.value; break; case 'shadow-blur-slider': s.shadow.blur = e.target.value; break; case 'shadow-offset-x-slider': s.shadow.x = e.target.value; break; case 'shadow-offset-y-slider': s.shadow.y = e.target.value; break; case 'stroke-toggle': s.stroke.enabled = e.target.checked; controls.strokeControls.classList.toggle('hidden'); break; case 'stroke-color-picker': s.stroke.color = e.target.value; break; case 'stroke-width-slider': s.stroke.width = e.target.value; break; case 'qr-size-slider': q.size = e.target.value; break; case 'qr-color-dark-picker': q.colorDark = e.target.value; break; case 'qr-color-light-picker': q.colorLight = e.target.value; break; case 'qr-logo-uploader': if (e.target.files[0]) uploadAndSetUrl(e.target.files[0], url => q.logoUrl = url); break; } updatePlaceholders(); }
function initializeControls() { controls.color.value = settings.name.color; controls.family.value = settings.name.family; controls.size.value = settings.name.size; controls.rotation.value = settings.name.rotation; controls.bold.checked = settings.name.bold; controls.italic.checked = settings.name.italic; controls.shadow.checked = settings.name.shadow.enabled; controls.shadowColor.value = settings.name.shadow.color; controls.shadowBlur.value = settings.name.shadow.blur; controls.shadowX.value = settings.name.shadow.x; controls.shadowY.value = settings.name.shadow.y; controls.stroke.checked = settings.name.stroke.enabled; controls.strokeColor.value = settings.name.stroke.color; controls.strokeWidth.value = settings.name.stroke.width; controls.qrSize.value = settings.qr.size; controls.qrColorDark.value = settings.qr.colorDark; controls.qrColorLight.value = settings.qr.colorLight; }
const handleFile = (file) => { if (!file || !file.type.startsWith('image/')) return; selectedFile = file; const reader = new FileReader(); reader.onload = (event) => DOMElements.imagePreview.src = event.target.result; reader.readAsDataURL(selectedFile); DOMElements.imagePreview.classList.remove('hidden'); DOMElements.uploadButton.disabled = false; };
const saveAndRedirect = () => { const areaRect = DOMElements.positioningArea.getBoundingClientRect(); const nameRect = DOMElements.namePlaceholder.getBoundingClientRect(); const qrRect = DOMElements.qrPlaceholder.getBoundingClientRect(); const cardTemplate = { imageUrl: cardImageUrl, nameSettings: { ...settings.name, x: (nameRect.left - areaRect.left + nameRect.width / 2) / areaRect.width, y: (nameRect.top - areaRect.top + nameRect.height / 2) / areaRect.height, fontSize: settings.name.size / areaRect.height }, qrSettings: { ...settings.qr, x: (qrRect.left - areaRect.left + qrRect.width / 2) / areaRect.width, y: (qrRect.top - areaRect.top + qrRect.height / 2) / areaRect.height, size: settings.qr.size / areaRect.width, } }; localStorage.setItem('cardTemplate', JSON.stringify(cardTemplate)); showNotification('designSaved', 'green'); setTimeout(() => window.location.href = 'manager.html', 1500); };
initializeControls();
setupEventListeners();
makeDraggable(DOMElements.namePlaceholder, settings.name);
makeDraggable(DOMElements.qrPlaceholder, settings.qr);
updatePlaceholders();
</script>
</body>
</html>
